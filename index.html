<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>resizer.js</title>
  <style type="text/css">
/*<![CDATA[*/
  <!--
  html, body {
    width:  100%;
    height: 100%;
    margin: 0px;
  }
  -->
  /*]]>*/
  </style>
</head>

<body onload="draw()">
  <canvas id="mycanvas">
    <div id="fallback">
        You only see this message if your browser doesn't support
        canvas.
    </div>
  </canvas>
  <script type="text/javascript">
//<![CDATA[
       
    var draw = function(){
        var target  = {
            width  : 230,
            height : 230,
            data   : new Array(230*230)
        };
        var canvas = document.getElementById('mycanvas');
        var context = canvas.getContext('2d');
        var imageObj = new Image();
        imageObj.crossOrigin = "";
        imageObj.onload = function() {
            canvas.width  = imageObj.width;
            canvas.height = imageObj.height;
            context.drawImage(imageObj, 0, 0);
            var imageData = context.getImageData(0,0,imageObj.width,imageObj.height);
            canvas.style.display = "none";
            canvas.width  = target.width;
            canvas.height = target.height;
            //resize
            target.data = context.getImageData(0,0,target.width,target.height);
            var scale = Math.max([target.width/imageObj.width,target.height/imageObj.height]);
            for (var y = 0; y < target.height; y++) {
                for (var x = 0; x < target.width; x ++) {
                    var xp = parseInt(Math.round(x / scale));
                    var yp = parseInt(Math.round(y / scale));
                    if (xp < imageObj.width && yp < imageObj.height) {
                        target.data.data[y * target.width * 4 + x * 4]     = imageData.data[yp * imageObj.width * 4 + xp * 4];     //red
                        target.data.data[y * target.width * 4 + x * 4 + 1] = imageData.data[yp * imageObj.width * 4 + xp * 4 + 1]; //green
                        target.data.data[y * target.width * 4 + x * 4 + 2] = imageData.data[yp * imageObj.width * 4 + xp * 4 + 2]; //blue
                        target.data.data[y * target.width * 4 + x * 4 + 3] = imageData.data[yp * imageObj.width * 4 + xp * 4 + 3]; //alpha
                    }
                }
            }
            console.log(target.data);
            context.putImageData(target.data,0,0);
            canvas.style.display = "block";
        };
        var isValidUrl = function(url) {
          var pattern = new RegExp('^(https?:\\/\\/)?'+       // protocol
          '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|'+ // domain name
          '((\\d{1,3}\\.){3}\\d{1,3}))'+                      // OR ip (v4) address
          '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+                  // port and path
          '(\\?[;&a-z\\d%_.~+=-]*)?');                        // query string
          return !!pattern.test(url);
        };
        var hashData = window.location.hash.substr(1).split('#');
        if(3 <= hashData.length){
            target.width  = parseInt(hashData[1]);
            target.height = parseInt(hashData[2]);
        }
        imageObj.src = isValidUrl(hashData[0]) 
            ? hashData[0]
            : 'https://avatars3.githubusercontent.com/u/16923';
      };
      document.onhashchange = draw;
  //]]>
  </script>
</body>
</html>
